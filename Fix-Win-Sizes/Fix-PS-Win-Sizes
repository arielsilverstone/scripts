#########################################################
# PowerShell Console Size Configuration Script V.1
# Description: Sets permanent console window size for multiple PowerShell versions
# Author: Generated by Claude
# Date: April 12, 2025
#########################################################

# Function to set permanent console size via registry
function Set-ConsolePermanentSize {
    # Check for administrative privileges to modify registry
    $IsAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
    
    # Prevent execution without admin rights
    if (-not $IsAdmin) {
        echo "This operation requires administrative privileges." -FGC Red
        return
    }

    # Registry paths to target different PowerShell console instances
    $ConsolePaths = @(
        "HKCU:\Console\%SystemRoot%_System32_WindowsPowerShell_v1.0_powershell.exe",
        "HKCU:\Console",
        "HKCU:\Console\powershell.exe",
        "HKCU:\Console\%SystemRoot%_System32_pwsh.exe"
    )
    
    # Define consistent window size parameters
    $Width = 100
    $Height = 27
    $FontSize = 20

    # Comprehensive try-catch block to apply console settings across multiple registry paths
    # Handles potential errors during registry modification while continuing processing
    try {
        # Iterate through each console path to ensure consistent settings
        foreach ($ConsolePath in $ConsolePaths) {
            # Create registry path if it doesn't exist
            if (-not (Test-Path $ConsolePath)) {
                ni -Path $ConsolePath -Force | Out-Null
            }

            # Set window size using bitwise operation
            # Combines height and width into a single registry-compatible value
            sp -Path $ConsolePath -Name "WindowSize" -Value ([int](($Height -shl 16) + $Width)) -EA 0
            
            # Set buffer size to allow scrolling
            # Creates a larger buffer height while maintaining consistent width
            sp -Path $ConsolePath -Name "ScreenBufferSize" -Value ([int](($Height * 5 -shl 16) + $Width)) -EA 0
            
            # Configure font settings for improved readability
            sp -Path $ConsolePath -Name "FontSize" -Value ([int]((20 -shl 16) + 20)) -EA 0
            sp -Path $ConsolePath -Name "FontFamily" -Value 0x00000036 -EA 0
            sp -Path $ConsolePath -Name "FaceName" -Value "Consolas" -EA 0
        }
        
        # Provide user feedback on successful configuration
        echo "Console size and font permanently set for PowerShell" -FGC Green
    }
    # Catch and log any unexpected errors during console configuration
    catch {
        # Display error details to assist with troubleshooting
        echo "Error setting console size: $_" -FGC Red
    }
}

# Execute the console size configuration function
Set-ConsolePermanentSize